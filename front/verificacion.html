<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification Panel</title>
    <style>
        .goal-container {
            margin: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        .goal-container img {
            max-width: 100%;
            max-height: 400px;
        }

        button {
            margin: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button.approve {
            background-color: #4caf50;
            color: white;
        }

        button.reject {
            background-color: #f44336;
            color: white;
        }
    </style>
</head>

<body>
    <h1>Verification Panel</h1>
    <div id="goals-container"></div>

    <script>
        const goalsContainer = document.getElementById('goals-container');

        async function fetchGoals() {
            const response = await fetch('http://localhost:5000/goals/pending', { credentials: 'include' });
            const goals = await response.json();
            goalsContainer.innerHTML = '';

            goals.forEach(goal => {
                const goalDiv = document.createElement('div');
                goalDiv.className = 'goal-container';

                const img = document.createElement('img');
                img.src = `http://localhost:5000/verify/evidence/${goal.id}/`;
                img.alt = 'Verification Evidence';

                const approveButton = document.createElement('button');
                approveButton.className = 'approve';
                approveButton.innerText = 'Approve';
                approveButton.onclick = () => submitDecision(goal.id, 'verified');

                const rejectButton = document.createElement('button');
                rejectButton.className = 'reject';
                rejectButton.innerText = 'Reject';
                rejectButton.onclick = () => submitDecision(goal.id, 'rejected');

                goalDiv.appendChild(img);
                goalDiv.appendChild(approveButton);
                goalDiv.appendChild(rejectButton);
                goalsContainer.appendChild(goalDiv);
            });
        }

        async function submitDecision(id, decision) {
            const response = await fetch(`http://localhost:5000/verify/respond-verification/${id}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ decision }),
                credentials:"include"
            });

            if (response.ok) {
                alert(`Goal ${id} has been ${decision}`);
                fetchGoals();
            } else {
                const error = await response.json();
                alert(`Error: ${error.message}`);
            }
        }

        // Fetch goals on load
        fetchGoals();

    </script>
</body>

</html>